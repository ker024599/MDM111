<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>QR & Style Switch</title>

    <!-- Link style mặc định -->
    <link id="main-style" rel="stylesheet" href="./style.css">

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://fonts.googleapis.com/css?family=Noto+Sans&display=swap" rel="stylesheet">
</head>
<body>

<div class="zhengti">
    <div class="juzuo1">
        V24050026 ( Jun Vu )
    </div>

    <div class="saomatishi juzhong" id="biaoti">
        将二维码对准扫描器扫码进出场
    </div>

    <!-- ... Các phần khác giữ nguyên ... -->

    <div class="juzhong erweima zise">
        <div class="juzuo2" id="dateTime00" style="font-weight: 500;"></div>
        <div id="neirong">
            <img class="ewm" src="./ewm.gif" alt="QR code">         
        </div>

        <!-- Nút nằm cùng 1 hàng -->
        <div id="neirong1" class="button-container">
            <!-- Nút 申请离场 sẽ ẩn khi chưa đổi style -->
            <button id="liChangBtn" class="footsty" style="display:none;">申请离场</button>
            <button id="shuaxinBtn" class="footsty">刷新二维码</button>
        </div>

        <div class="juzhong footsty yishengxiao word_breath">
            <div style="display:" onclick="changetxt()">已生效</div>
        </div>

        <div class="juzhong footsty shijian">
            <div id="dateTime3">00:00</div>
        </div>
    </div>

    <div class="dierhang">
        尊敬的员工您好，您已进入企业涉密区域，出于企业安全考虑，您的手机摄像头将被禁止拍摄，感谢您的配合。
    </div>
</div>

<script>
    // Hàm format thời gian
    Date.prototype.format = function (fmt) {
        var o = {
            "y+": this.getFullYear(),
            "M+": this.getMonth() + 1,
            "d+": this.getDate(),
            "h+": this.getHours(),
            "m+": this.getMinutes(),
            "s+": this.getSeconds(),
        };
        if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
        for (var k in o)
            if (new RegExp("(" + k + ")").test(fmt))
                fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
        return fmt;
    }

    // Hiển thị thời gian thực
    setInterval(() => {
        const dt = document.getElementById('dateTime00');
        if (dt) dt.innerHTML = (new Date()).format('yyyy-M-d hh:mm:ss');
    }, 1000);

    // Biến thời gian bắt đầu
    let startTime = localStorage.getItem("startTime");
    if (!startTime) {
        startTime = Date.now();
        localStorage.setItem("startTime", startTime);
    } else {
        startTime = parseInt(startTime);
    }

    // Cập nhật bộ đếm thời gian mỗi giây
    setInterval(() => {
        let diff = Math.floor((Date.now() - startTime) / 1000);
        let hrs = Math.floor(diff / 3600);
        let mins = Math.floor((diff % 3600) / 60);
        let secs = diff % 60;

        if (hrs >= 12) {
            startTime = Date.now();
            localStorage.setItem("startTime", startTime);
            hrs = 0; mins = 0; secs = 0;
        }

        document.getElementById('dateTime3').innerHTML = 
            (hrs > 0 ? hrs + ':' : '') +
            (mins < 10 ? '0' : '') + mins + ':' +
            (secs < 10 ? '0' : '') + secs;
    }, 1000);

    // Đổi giao diện và reset thời gian khi nhấn "刷新二维码" 5 lần trong 5 giây
    const styleLink = document.getElementById('main-style');
    const shuaxinBtn = document.getElementById('shuaxinBtn');
    const liChangBtn = document.getElementById('liChangBtn');

    let clickTimestamps = [];

    function toggleStyleAndResetTime() {
        // Reset thời gian
        startTime = Date.now();
        localStorage.setItem("startTime", startTime);
        document.getElementById('dateTime3').innerHTML = '00:00';

        // Đổi CSS
        if (styleLink.href.includes('style.css')) {
            styleLink.href = './style1.css';
            // Hiển thị nút 申请离场
            liChangBtn.style.display = 'inline-block';
        } else {
            styleLink.href = './style.css';
            // Ẩn nút 申请离场
            liChangBtn.style.display = 'none';
        }
    }

    shuaxinBtn.addEventListener('click', () => {
        const now = Date.now();
        clickTimestamps.push(now);
        // Lọc các lần click trong 5 giây gần nhất
        clickTimestamps = clickTimestamps.filter(t => now - t <= 5000);

        if (clickTimestamps.length >= 5) {
            toggleStyleAndResetTime();
            clickTimestamps = [];
            console.log('⏱️ Đã reset thời gian và đổi giao diện sau 5 lần nhấn trong 5 giây');
        }
    });

    // Hàm changetxt (giữ nguyên)
    function changetxt() {
        document.getElementById('biaoti').innerText = "您的设备已符合安全规范";
        document.getElementById('neirong').innerHTML =
            "<img class='true' src='./true.png'>" +
            "<div class='truetxt'>" +
            "<p class='jinchang'>进场成功</p>" +
            "<p class='riqi' id='dateTime01'></p></div>";

        setInterval(function () {
            const dt = document.getElementById('dateTime01');
            if (dt) {
                dt.innerHTML = (new Date()).format('yyyy-MM-dd hh:mm');
            }
        }, 1000);
    }

</script>

</body>
</html>
